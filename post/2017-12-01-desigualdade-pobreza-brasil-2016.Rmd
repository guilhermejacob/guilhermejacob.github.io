---
title: "O que a PNAD Contínua 2016 diz sobre desigualdade e pobreza nos estados?"
author: ~
date: '2017-12-03'
slug: desigualdade-pobreza-estados-2016
categories: [ "Amostragem" ]
tags: [ "Pobreza" , "Desigualdade" , "rstats" ]
draft: false
---

```{r setup_session, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(cache=TRUE) # defaults to cacheing
```

<!--html_preserve-->
{{< alert warning >}}
<b>Atualização (21/12/2019):</b> refiz todas as análises usando a nova definição de renda domiciliar per capita e seu respectivo deflator.<br>
{{< /alert >}}
<!--/html_preserve-->

Na última quarta (29/11), o IBGE ~~finalmente~~ apresentou as estimativas relativas aos rendimentos de todas as fontes, além de disponibilizar os microdados para os cálculos.

*Ok, mas o que isso quer dizer?* Aguardei ansiosamente^[Eu + ansiedade é, praticamente, [pleonasmo](https://pt.wikipedia.org/wiki/Pleonasmo).] para saber como as coisas irão funcionar com o fim da *PNAD* ~~anual~~ e introdução da *PNAD Contínua*.  
Antes, a PNAD trazia informações referentes ao ano. Agora, a PNAD Contínua traz informações sobre os trimestres. E quanto às informações anuais?  
Bom, isso acaba de ser respondido.

Dito isso, vamos às estimativas^[Todas as estimativas foram realizadas utilizando a *library* [`convey`](https://cran.r-project.org/web/packages/convey/index.html).].

### Desigualdade

Eu tinha certa curiosidade a respeito do quanto as novas variáveis de renda diferenciam das antigas quando se trata de desigualdade. Essa dúvida não foi completamente respondida, já que os dados concomitantes de rendimento da PNAD Contínua e PNAD anual ainda não são estão disponíveis. Mas já podemos ter alguns números.

<!--html_preserve-->
{{< alert warning >}}
Todos as estimativas a seguir foram feitas por mim.<br>Assim, nem IBGE, nem qualquer outra instituição tem nada a ver com os meus comentários ou conclusões. **Ou seja: nada aqui é definitivo**.
{{< /alert >}}
<!--/html_preserve-->

```{r database_setup, eval=FALSE, message=FALSE, warning=FALSE, cache=FALSE, include=FALSE}
# calcula resultados

# carrega libraries
library(here)
library(readxl)
library(data.table)
library(fst)
library(survey)
library(convey)

# opções para a library `survey`
options( survey.lonely.psu = "adjust" )
options( survey.multicore = TRUE )

# set uf table
uf <-
  structure(list(V1 = c(11L, 12L, 13L, 14L, 15L, 16L, 17L, 21L, 
                        22L, 23L, 24L, 25L, 26L, 27L, 28L, 29L, 31L, 32L, 33L, 35L, 41L, 
                        42L, 43L, 50L, 51L, 52L, 53L), 
                 V2 = structure(c(22L, 1L, 4L, 
                                  23L, 14L, 3L, 27L, 10L, 18L, 6L, 20L, 15L, 17L, 2L, 26L, 5L, 
                                  13L, 8L, 19L, 25L, 16L, 24L, 21L, 12L, 11L, 9L, 7L), 
                                .Label = c("Acre", "Alagoas", "Amapá", "Amazonas", "Bahia", "Ceará", "Distrito Federal", 
                                           "Espírito Santo", "Goiás", "Maranhão", "Mato Grosso", "Mato Grosso do Sul", 
                                           "Minas Gerais", "Pará", "Paraíba", "Paraná", "Pernambuco", "Piauí", 
                                           "Rio de Janeiro", "Rio Grande do Norte", "Rio Grande do Sul", 
                                           "Rondônia", "Roraima", "Santa Catarina", "São Paulo", "Sergipe", 
                                           "Tocantins"), class = "factor")), .Names = c("uf", "uf_name"), 
            class = "data.frame", row.names = c(NA, -27L))
uf$cp_name <- c("Porto Velho" , "Rio Branco" , "Manaus", "Boa Vista", "Belém", "Macapá", "Palmas", "São Luís", "Teresina", 
                "Fortaleza" , "Natal", "João Pessoa" , "Recife" , "Maceió" , "Aracaju", "Salvador", "Belo Horizonte" , 
                "Vitória" , "Rio de Janeiro", "São Paulo" , "Curitiba", "Florianópolis" , "Porto Alegre", "Campo Grande", 
                "Cuiabá", "Goiânia" , "Brasília" )

# monta tabela com deflatores
# lê arquivo do excel
deflat_tab <- read_xls( here( "resources/deflator_2017_pnadc.xls" ) , sheet = 1 )

# converte para data.table
deflat_tab <- as.data.table( deflat_tab )

# ajusta nomes
colnames( deflat_tab ) <- tolower( colnames( deflat_tab ) )
setnames( deflat_tab , "trim" , "trimestre" )

# lista arquivos
data_dir <- path.expand( "~/Bases/PNAD Contínua/Anual" )
these_files <- list.files( data_dir , full.names = TRUE , recursive = TRUE )

# filtra para 1ª entrevista
these_files <- these_files[ grepl( "1 pnadc" , basename( these_files ) ) ]

# filtra anos
these_files <- these_files[ grepl( "2016" , basename( these_files ) ) ]

# cria objetos de desenho amostral
pnadc_df <- lapply( these_files, function( this_file ) {
  
  # define colunas
  these_columns <- c("ano", "trimestre", "uf", "capital", "upa", "estrato", "v1008" , "v1030", "v1031", "posest", 
                     "v1022", "v2007" , "v2009" , "vd2002" , "vd2003" , "vd4016" , "vd4019" , "vd4048" )
  
  # ajusta colunas
  these_columns <- intersect( fst.metadata( this_file )[[4]] , these_columns )
  
  # lê base de dados
  pnadc_df <- read_fst( this_file , columns = these_columns , as.data.table = TRUE )
  
  # # total de moradores
  # pnadc_df[ !(vd2002 %in% 17:19) , nmor := .N , by = .( upa , v1008 ) ]
  
  # cria agregados de renda domiciliar
  pnadc_df[ !(vd2002 %in% 17:19) , rtrab := sum( vd4019 , na.rm = TRUE ) , by = .( upa , v1008 ) ] # habitual de todos os trabalhos
  pnadc_df[ !(vd2002 %in% 17:19) , routr := sum( vd4048 , na.rm = TRUE ) , by = .( upa , v1008 ) ] # efetivo de outras fontes
  pnadc_df[ !(vd2002 %in% 17:19) , rdom := rtrab + routr ] # rendimento domiciliar
  pnadc_df[ !(vd2002 %in% 17:19) , rdpc := rdom / vd2003 ] # rendimento domiciliar per capita
  
  # combina deflator
  pnadc_df <- merge( pnadc_df , deflat_tab , by = c( "ano" , "trimestre" , "uf" ) , all.x = TRUE , all.y = FALSE )
  
  # deflaciona os rendas: habitual
  these_inc_cols <- c( intersect( c( "vd4016" , "vd4019" ) , these_columns ) , "rtrab" ) 
  pnadc_df[ , paste0( "def_" , these_inc_cols ) := lapply( .SD , function(x) x * co2 ) , .SDcols = these_inc_cols ]
  
  # deflaciona os rendas: efetivo
  these_inc_cols <- c( intersect( c( "vd5007" , "vd5008" , "vd4048" ) , these_columns ) , "routr" )
  pnadc_df[ , paste0( "def_" , these_inc_cols ) := lapply( .SD , function(x) x * co2e ) , .SDcols = these_inc_cols ]
  
  # cria agregados de renda domiciliar deflacionado
  pnadc_df[ !(vd2002 %in% 15:17) , def_rdom := def_rtrab + def_routr ] # rendimento domiciliar deflacionado
  pnadc_df[ !(vd2002 %in% 15:17) , def_rdpc := def_rdom / vd2003 ] # rendimento domiciliar per capita deflacionado
  
  # adiciona nomes de uf
  pnadc_df <- merge( pnadc_df , uf , by = "uf" )
  
  # ajusta capital
  pnadc_df[ is.na( capital ), cp_name := NA ]
  
  # coluna unitária
  pnadc_df[, one := 1]
  
  # cria regiao
  pnadc_df[, regiao := factor( substr( uf , 1 , 1 ) , labels = c( "Norte" , "Nordeste" , "Sudeste" , "Sul" , "Centro-Oeste" ) ) ]
  
  # cria situação do domicílio
  pnadc_df[, v1022 := factor( v1022 , labels = c( "Urbano" , "Rural" ) ) ]
  
  # cria sexo
  pnadc_df[, v2007 := factor( v2007 , labels = c( "Homem" , "Mulher" ) ) ]
  
  # retorna objeto
  pnadc_df
  
} )

# empilha bases de dados
pnadc_df <- rbindlist( pnadc_df , use.names = TRUE )

# calcula totais de pós-estratificação
df_pos <- pnadc_df[ !duplicated( pnadc_df[ , .( ano , posest ) ] ) ,  .( ano , posest , Freq = v1030 ) ]
df_pos <- data.frame( df_pos , stringsAsFactors = FALSE )

# transforma em data.frame
pnadc_df <- data.frame( pnadc_df , stringsAsFactors = FALSE )

# desenho amostral sem pós-estratificação
pnadc_design <-
  svydesign(
    ids = ~ upa , 
    strata = ~ interaction( ano , estrato ) , 
    weights = ~ v1031 , 
    data = pnadc_df ,
    nest = TRUE
  )

# objeto de desenho amostral final
pnadc_design <- postStratify( pnadc_design , ~ ano + posest , df_pos )

# remove objetos desnecessários
rm( pnadc_df , df_pos , uf , deflat_tab ) ; gc()

# aplica convey
pnadc_design <- convey_prep( pnadc_design )

# define fórmulas
formulae <- list( ~ano+one , ~ano+uf+uf_name )

# estima índice de gini
res1 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svygini , na.rm = TRUE , vartype = "ci" ) )

# estima razão de palma
res2 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyqsr , alpha2 = .9 , alpha1 = .4 , na.rm = TRUE , vartype = "ci" ) )

# estima índice de zenga
res3 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyzenga , na.rm = TRUE , vartype = "ci" ) )

# estima fgt0
res4 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyfgt , g = 0 , abs_thresh = 220 , na.rm = TRUE , vartype = "ci" ) )

# estima fgt1
res5 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyfgt , g = 1 , abs_thresh = 220 , na.rm = TRUE , vartype = "ci" ) )

# estima fgt2
res6 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyfgt , g = 2 , abs_thresh = 220 , na.rm = TRUE , vartype = "ci" ) )

# estima decomposição do fgt2
res7 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyfgtdec , g = 2 , abs_thresh = 220 , na.rm = TRUE ) )

# clean workspace
rm( pnadc_design , formulae , these_files , data_dir ) ; gc()

# salva objetos
save.image( here( "resources/despob_2016.Rds" ) )
```

##### Índice de Gini

```{r load_results, eval=TRUE, message=FALSE, warning=FALSE, cache=FALSE, include=FALSE}
# carrega estatísticas

# carrega libraries
library(here)
library(data.table)
library(survey)
library(convey)
library(ggplot2)
library(gridExtra)
library(grid)
library(scales)
# library(ggiraph)
library(knitr)
library(kableExtra)

# carrega dados
load( here( "resources/despob_2016.Rds" ) )
```

Vamos começar com a medida de desigualdade mais utilizada, o [índice de Gini](https://pt.wikipedia.org/wiki/Coeficiente_de_Gini). O Distrito Federal é o estado mais desigual do país. Ainda assim, os intervalos de confiança não permitem dizer que existam diferenças estatisticamente significativas entre muitos estados.
```{r gini_plot, echo=FALSE, message=FALSE, warning=FALSE }
# empilha gini
res1 <- lapply( res1 , data.table )
res1 <- rbindlist( res1 , use.names = TRUE , fill = TRUE )
res1[ is.na( uf ) , area := "Brasil" ]
res1[ !is.na( uf ) , area := uf_name ]
res1 <- res1[ order( one , -def_rdpc , na.last = TRUE ) , ]
plot_order <- rev( res1[ !is.na( uf ) | area == "Brasil" ]$area )

gini_scale <- function(x) gsub( ".*\\." , "." , sprintf('%.3f', x ) )

# create plot object
gini_uf <- 
  ggplot( res1 , aes( area, def_rdpc , group = area , color = area ) ) +
  geom_line( alpha = .3 ) + 
  geom_errorbar(aes(ymin=ci_l, ymax=ci_u), width=.1 , alpha = .5 ) +
  geom_point( size = 1) +
  scale_y_continuous( labels = gini_scale , expand = c(0,0) ) +
  scale_x_discrete( limits = plot_order ) +
  coord_flip( ylim=c(.3 , .72) ) +
  labs( x = NULL , y = "Índice de Gini", 
        title = "Índice de Gini da Renda Domiciliar Per Capita" , 
        subtitle ="Brasil e UFs, 2016.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016, 1ª entrevista. Microdados.") +
  # scale_color_brewer(type = "qual" , palette = "Dark2" , direction = 1 ) +
  guides(color = FALSE ) +
  # theme_dark() +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_line( linetype = 2 , color = "lightgrey" , size = .2 ) ,
         # panel.grid.minor.x = element_blank() , 
         # panel.grid.minor.x = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1) ,
         plot.title = element_text(lineheight=.8, face="bold") ) 

gini_uf
# ggiraph( code = { print( gini_uf ) } , zoom_max = 1 , width = 1 , tooltip_opacity = .7 , width_svg = 8, height_svg= 5 )
```

A outra coisa clara neste gráfico é que Santa Catarina é o estado menos desigual, embora a diferença em relação ao segundo menos desigual, Mato Grosso, não seja estatisticamente significativa.

No entanto, é importante lembrar que o índice de Gini tem seus problemas^[Sobre os potenciais problemas do índice de Gini, sugiro [esse artigo](https://oxfamblogs.org/fp2p/on-inequality-lets-do-the-palma-because-the-gini-is-so-last-century/).]. Por conta disso, vamos explorar algumas alternativas, como a razão de Palma e o índice de Zenga.

##### Razão de Palma

A [razão de Palma](http://www.un.org/esa/desa/papers/2015/wp143_2015.pdf) é bastante intuitiva. Basicamente, este índice é a razão entre as rendas dos 10% mais ricos sobre a dos 40% mais pobres. Dessa forma, ele consegue ser mais sensível aos extremos da distribuição de renda do que o índice de Gini, por exemplo. Vejamos os resultados para o Brasil.
```{r palma_plot, echo=FALSE, message=FALSE, warning=FALSE }
# empilha razão de palma
res2 <- lapply( res2 , data.table )
res2 <- rbindlist( res2 , use.names = TRUE , fill = TRUE )
res2[ is.na( uf ) , area := "Brasil" ]
res2[ !is.na( uf ) , area := uf_name ]
res2 <- res2[ order( one , -def_rdpc , na.last = TRUE ) , ]
plot_order <- rev( res2[ !is.na( uf ) | area == "Brasil" ]$area )

# create plot object
palma_uf <- 
  ggplot( res2 , aes( area, def_rdpc , group = area , color = area ) ) +
  geom_line( alpha = .3 ) + 
  geom_errorbar(aes(ymin=ci_l, ymax=ci_u), width=.1 , alpha = .5 ) +
  geom_point( size = 1) +
  scale_y_continuous(  expand = c(0,.5) , breaks = seq(1,6,1) ) +
  scale_x_discrete( limits = plot_order ) +
  coord_flip( ylim=c( 1 , 6) ) +
  labs( x = NULL , y = "Razão de Palma", 
        title = "Razão de Palma da Renda Domiciliar Per Capita" , 
        subtitle ="Brasil e UFs, 2016.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016, 1ª entrevista. Microdados.") +
  # scale_color_brewer(type = "qual" , palette = "Dark2" , direction = 1 ) +
  guides(color = FALSE ) +
  # theme_dark() +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_line( linetype = 2 , color = "lightgrey" , size = .2 ) ,
         # panel.grid.minor.x = element_blank() , 
         # panel.grid.minor.x = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1) ,
         plot.title = element_text(lineheight=.8, face="bold") )
  
palma_uf
# ggiraph( code = { print( palma_uf ) } , zoom_max = 1 , width = 1 , tooltip_opacity = .7 , width_svg = 8, height_svg= 5 )
```

Bom, o ordenamento muda um pouco. Embora o DF continue sendo o mais desigual, Pernambuco cai uma posição. Isso se deve ao fato deste índice ser um pouco mais sensível aos extremos da distribuição.
Entretanto, este índice também sofre algumas críticas. De fato, ele não atende muitos axiomas esperados dos índices de desigualdade. Com isso em mente, incluiremos mais um índice.

##### Índice de Zenga

O [índice de Zenga](https://link.springer.com/article/10.1007/s10687-013-0177-2) é uma medida relativamente recente. Ele satisfaz os mesmos axiomas que o índice de Gini, mas "pesa" todas as observações igualmente, mantendo a mesma sensibilidade ao longo de toda a distribuição de renda.
```{r zenga_plot, echo=FALSE, message=FALSE, warning=FALSE }
# empilha índice de zenga
res3 <- lapply( res3 , data.table )
res3 <- rbindlist( res3 , use.names = TRUE , fill = TRUE )
res3[ is.na( uf ) , area := "Brasil" ]
res3[ !is.na( uf ) , area := uf_name ]
res3 <- res3[ order( one , -def_rdpc , na.last = TRUE ) , ]
plot_order <- rev( res3[ !is.na( uf ) | area == "Brasil" ]$area )

# create plot object
zenga_uf <-
  ggplot( res3 , aes( area, def_rdpc , group = area , color = area ) ) +
  geom_line( alpha = .3 ) + 
  geom_errorbar(aes(ymin=ci_l, ymax=ci_u), width=.1 , alpha = .5 ) +
  geom_point( size = 1) +
  scale_y_continuous(  expand = c(.05,.05) , breaks = seq(0 , 1 , .05) ) +
  scale_x_discrete( limits = plot_order ) +
  coord_flip( ylim=c( .7 , .9) ) +
  labs( x = NULL , y = "Índice de Zenga", 
        title = "Índice de Zenga da Renda Domiciliar Per Capita" , 
        subtitle ="Brasil e UFs, 2016.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016, 1ª entrevista. Microdados.") +
  # scale_color_brewer(type = "qual" , palette = "Dark2" , direction = 1 ) +
  guides(color = FALSE ) +
  # theme_dark() +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_line( linetype = 2 , color = "lightgrey" , size = .2 ) ,
         # panel.grid.minor.x = element_blank() , 
         # panel.grid.minor.x = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1) ,
         plot.title = element_text(lineheight=.8, face="bold") )

zenga_uf
# ggiraph( code = { print( zenga_uf ) } , zoom_max = 1 , width = 1 , tooltip_opacity = .7 , width_svg = 8, height_svg= 5 )
```

O gráfico revela uma distribuição similar ao da razão de Palma. 
Em todos os casos, o Distrito Federal apresenta a maior desigualdade.

#### Pobreza

Olha a desigualdade não é suficiente para analisar a condição de vida na sociedade. Afinal, uma sociedade A pode ser mais desigual que a sociedade B, tendo um nível de pobreza inferior.  
Neste exercício, consideramos a linha de pobreza equivalente a 1/4 do salário mínimo em julho de 2016. Ou seja, R$ 220,00. De fato, esse valor pode ser considerado como uma linha de extrema pobreza.

Vejamos, então, as estatísticas de pobreza no Brasil.

##### Taxa de Pobreza

O indicador mais utilizado quando se discute pobreza é a taxa de pobreza. Basicamente, essa medida é a proporção de pessoas consideradas pobres em determinada população.
```{r fgt0_plot, echo=FALSE, message=FALSE, warning=FALSE }
# empilha fgt0
res4 <- lapply( res4 , data.table )
res4 <- rbindlist( res4 , use.names = TRUE , fill = TRUE )
res4[ is.na( uf ) , area := "Brasil" ]
res4[ !is.na( uf ) , area := uf_name ]
res4 <- res4[ order( one , -def_rdpc , na.last = TRUE ) , ]
plot_order <- rev( res4[ !is.na( uf ) | area == "Brasil" ]$area )

fgt0_uf <- ggplot( res4 , aes( area, def_rdpc , group = area , color = area ) ) +
  geom_line( alpha = .3 ) + 
  geom_errorbar(aes(ymin=ci_l, ymax=ci_u), width=.1 , alpha = .5 ) +
  geom_point( size = 1) +
  scale_y_continuous( labels = percent_format( accuracy = 1 ) , breaks = seq(0 , 1 , .05 ) ) +
  scale_x_discrete( limits = plot_order ) +
  coord_flip( ylim=c( 0 , .4) ) +
  labs( x = NULL , y = "FGT(0)", 
        title = "Taxa de Pobreza" , 
        subtitle ="Brasil e UFs, 2016. Linha de Pobreza: R$ 220,00.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016, 1ª entrevista. Microdados.") +
  # scale_color_brewer(type = "qual" , palette = "Dark2" , direction = 1 ) +
  guides(color = FALSE ) +
  # theme_dark() +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_line( linetype = 2 , color = "lightgrey" , size = .2 ) ,
         # panel.grid.minor.x = element_blank() , 
         # panel.grid.minor.x = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1) ,
         plot.title = element_text(lineheight=.8, face="bold") )

  
fgt0_uf
# ggiraph( code = { print( fgt0_uf ) } , zoom_max = 1 , width = 1 , tooltip_opacity = .7 , width_svg = 8, height_svg= 5 )
```
As estimativas revelam que, na prática, existe um *empate* entre a proporção de pessoas pobres no Acre e Amazonas. Olhando o resto da lista, pode-se ver que os estados do Norte e Nordeste tendem a "liderar" neste ranking.

##### Hiato de Pobreza

Em que pese a sua simplicidade, a taxa de pobreza tem um problema: a pessoa que tem R\$ 1 a menos da linha de pobreza recebe o mesmo peso da pessoa que tem R\$ 200. Desta forma, perde muito da informação a respeito da intensidade da pobreza.  
A classe *Foster-Greer-Thorbecke (FGT)* de índices de pobreza apresenta como solução o *Hiato de Pobreza*. Este índice pondera cada obervação pela distância em relação à linha de pobreza.

```{r fgt1_plot, echo=FALSE, message=FALSE, warning=FALSE }
# empilha fgt1
res5 <- lapply( res5 , data.table )
res5 <- rbindlist( res5 , use.names = TRUE , fill = TRUE )
res5[ is.na( uf ) , area := "Brasil" ]
res5[ !is.na( uf ) , area := uf_name ]
res5 <- res5[ order( one , -def_rdpc , na.last = TRUE ) , ]
plot_order <- rev( res5[ !is.na( uf ) | area == "Brasil" ]$area )

fgt1_uf <- ggplot( res5 , aes( area, def_rdpc , group = area , color = area ) ) +
  geom_line( alpha = .3 ) + 
  geom_errorbar(aes(ymin=ci_l, ymax=ci_u), width=.1 , alpha = .5 ) +
  geom_point( size = 1) +
  scale_y_continuous( labels = percent_format( accuracy = 1 ) , breaks = seq(0 , 1 , .05 ) ) +
  scale_x_discrete( limits = plot_order ) +
  coord_flip( ylim=c( 0 , .175) ) +
  labs( x = NULL , y = "FGT(1)", 
        title = "Índice do Hiato de Pobreza" , 
        subtitle ="Brasil e UFs, 2016. Linha de Pobreza: R$ 220,00.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016, 1ª entrevista. Microdados.") +
  # scale_color_brewer(type = "qual" , palette = "Dark2" , direction = 1 ) +
  guides(color = FALSE ) +
  # theme_dark() +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_line( linetype = 2 , color = "lightgrey" , size = .2 ) ,
         # panel.grid.minor.x = element_blank() , 
         # panel.grid.minor.x = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1) ,
         plot.title = element_text(lineheight=.8, face="bold") )

fgt1_uf
```

Aqui, o ordenamento muda um pouco. Embora Maranhão continue liderando, o Amazonas cai algumas posições. Comparando Amazonas e Acre, isto indica que, embora a *extensão* da pobreza entre as duas populações seja praticamente idêntica, a pobreza no Acre é *mais intensa*. Em outras palavras: a renda domiciliar per capita entre as pessoas em situação de pobreza neste estado é inferior à do Amazonas.  
Isso tem impactos importantes quanto às políticas públicas. Por exemplo, um programa de transferência de renda exigiria, *proporcionalmente*, mais recursos no Acre do que no Amazonas.

##### Hiato Quadrático de Pobreza

Outro índice da classe FGT, o Hiato Quadrático de Pobreza incorpora a desigualdade de renda entre a população em situação de pobreza. Ao contrário do Hiato de Pobreza, a distância entre a renda de determinada observação e a linha de pobreza é elevada ao quadrado. Ou seja: os mais pobres recebem pesos ainda maiores no processo de ponderação.  

Isto implica que transferências regressivas de renda entre os pobres são penalizadas. Por exemplo, se a renda do indivíduo A, mais pobre, é transferida para o indivíduo B (menos pobre), o Hiato de Pobreza é o mesmo, mas o Hiato Quadrático é diferente.  

Isso também pode ser visto de outra maneira. Considerando a classe de *índices de Entropia Generalizada (GEI)*, uma classe de medidas de desigualdade, podemos reescrever o índice FGT(2) como uma função da Taxa de Pobreza, Hiato de Pobreza e do índice GEI(2) das insuficiências de renda. Assim, evidenciamos o efeito da desigualdade entre as rendas dos pobres sobre a estimativa do FGT(2). Matematicamente,

$$
FGT_{2}= \frac{FGT_1^2}{FGT_0} \cdot \bigg( 1 + 2 \cdot GEI_{2}^{*} \bigg) \text{ ,} 
$$

onde $GEI_{2}^{*}$ é o índice GEI($\epsilon$=2) das insuficiências de renda.

Vejamos os resultados dos estados brasileiros.
```{r fgt2_plot, echo=FALSE, message=FALSE, warning=FALSE }
# empilha fgt2
res6 <- lapply( res6 , data.table )
res6 <- rbindlist( res6 , use.names = TRUE , fill = TRUE )
res6[ is.na( uf ) , area := "Brasil" ]
res6[ !is.na( uf ) , area := uf_name ]
res6 <- res6[ order( one , -def_rdpc , na.last = TRUE ) , ]
plot_order <- rev( res6[ !is.na( uf ) | area == "Brasil" ]$area )

fgt2_uf <- ggplot( res6 , aes( area, def_rdpc , group = area , color = area ) ) +
  geom_line( alpha = .3 ) + 
  geom_errorbar(aes(ymin=ci_l, ymax=ci_u), width=.1 , alpha = .5 ) +
  geom_point( size = 1) +
  scale_y_continuous( labels = percent_format( accuracy = 1 ) , breaks = seq(0 , 1 , .05 ) ) +
  scale_x_discrete( limits = plot_order ) +
  coord_flip( ylim=c( 0 , .10 ) ) +
  labs( x = NULL , y = "FGT(2)", 
      title = "Índice do Hiato Quadrático de Pobreza" , 
        subtitle ="Brasil e UFs, 2016. Linha de Pobreza: R$ 220,00.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016, 1ª entrevista. Microdados.") +
  # scale_color_brewer(type = "qual" , palette = "Dark2" , direction = 1 ) +
  guides(color = FALSE ) +
  # theme_dark() +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_line( linetype = 2 , color = "lightgrey" , size = .2 ) ,
         # panel.grid.minor.x = element_blank() , 
         # panel.grid.minor.x = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1) ,
         plot.title = element_text(lineheight=.8, face="bold") )

fgt2_uf
```

De novo, Maranhão é o primeiro do ranking. Porém, o Amazonas se distancia bastante agora. O que isso quer dizer? Talvez a decomposição do índice pode nos ajudar a entender as diferenças nas estimativas do FGT(2) entre as populações.

```{r fgt2dec_table, echo=FALSE, message=FALSE, warning=FALSE }
# empilha decomposições do fgt2
res7 <- lapply( res7 , data.table )
res7 <- rbindlist( res7 , use.names = TRUE , fill = TRUE )
res7[ is.na( uf ) , area := "Brasil" ]
res7[ !is.na( uf ) , area := uf_name ]
res7 <- res7[ order( one , -fgt2 , na.last = TRUE ) , ]
plot_order <- rev( res7[ !is.na( uf ) | area == "Brasil" ]$area )

table_res7 <- res7[ , c(15,3,4,5,7) ]
tb7_names <- c( "Área" , "FGT(2)" , "FGT(0)" , "FGT(1)" , "GEI(2)" )

table_res7 <- kable( table_res7 , col.names = tb7_names , row.names = FALSE , digits = c( 3,3,3,3 ), 
                 format = "html", longtable = FALSE , booktabs = TRUE , align = c("l","l","r","r","r") ,
                 caption = "Decomposição do Hiato Quadrático de Pobreza, 2016." , label = "tab_fgt" )
table_res7 <- table_res7 %>% footnote( general = "PNAD Contínua 2016, 1ª entrevista. Microdados." , general_title = "Fonte:" )
table_res7
```

No caso, ainda que o Amazonas apresente maior desigualdade no renda-linha de pobreza dos domicílios pobres, as diferenças na extensão e intensidade são os determinantes deste ordenamento. Isso implica que embora a desigualdade seja mais intensa no Amazonas, a população em situação de pobreza ainda está, em média, numa situação melhor que a do Maranhão.

### Concluindo

Embora ainda não tenhamos uma série suficientemente longa para compreender o impacto da crise sobre a pobreza e desigualdade no Brasil, já conseguimos observar a situação dos estados. Como a ideia aqui era só uma análise superficial, muita coisa ainda precisa ser explorada. Por exemplo: 

* Como os preços afetam a distribuição de renda?
* Como os rendimentos de programas sociais afetam a desigualdade e pobreza?

Acredito que ainda veremos mais sobre esses dados nos próximos meses.

E, como não poderia faltar, o vídeo de final de post!  
Já começaram a contagem regressiva para o carnaval?  
Nesse vídeo, Bruna Caram e Marina de la Riva interpretam *Bloco do Prazer*, de Moraes Moreira.

<!--html_preserve-->
<div style="position:relative;height:0;padding-bottom:56.21%"><iframe src="https://www.youtube.com/embed/aem2JxlRfGo?ecver=2" style="position:absolute;width:100%;height:100%;left:0" width="641" height="360" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe></div>
<!--/html_preserve-->
