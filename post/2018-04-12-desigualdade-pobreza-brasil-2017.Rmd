---
title: "PNAD Contínua 2017: extrema pobreza na infância e desigualdade"
author: "Guilherme Jacob"
date: '2018-04-24'
slug: desigualdade-pobreza-infancia-2017
categories: ["Amostragem"]
tags: ["Pobreza", "Desigualdade", "rstats"]
draft: false
language: "pt-br"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set( message = FALSE, warning = FALSE, cache = TRUE  , fig.height = 5)
```

<!--html_preserve-->
{{< alert warning >}}
<b>Atualização (21/12/2019):</b> refiz todas as análises usando a nova definição de renda domiciliar per capita e seu respectivo deflator.<br>
{{< /alert >}}
<!--/html_preserve-->

Interrompendo o meu hiato de alguns meses, resolvi voltar com uma comparação os dados de renda das PNADCs anuais 2016-2017. No entanto, vamos falar um pouco da desigualdade em geral e, então, partir para uma questão mais específica: pobreza na infância^[Para os fins deste post, infância é, na verdade, infância e adolescência, compreendendo o período do nascimento até os 18 anos incompletos.].

Mas, antes de tudo, um aviso:

<!--html_preserve-->
{{< alert warning >}}
Todos as estimativas a seguir foram feitas por mim.<br>Assim, nem IBGE, nem qualquer outra instituição tem responsabilidade a respeito dos meus comentários ou conclusões.
{{< /alert >}}
<!--/html_preserve-->

Nas análises abaixo, as rendas foram ajustadas para valores de julho de 2017, de modo que seja possível comparar as mesmas cestas de consumo. Sem mais delongas, vamos às estimativas!^[Todas as estimativas foram realizadas utilizando a *library* [`convey`](https://cran.r-project.org/web/packages/convey/index.html).]

```{r database_setup, eval=FALSE, message=FALSE, warning=FALSE, cache=FALSE, include=FALSE}
# calcula resultados

# carrega libraries
library(here)
library(readxl)
library(data.table)
library(fst)
library(survey)
library(convey)

# opções para a library `survey`
options( survey.lonely.psu = "adjust" )
options( survey.multicore = TRUE )

# set uf table
uf <-
  structure(list(V1 = c(11L, 12L, 13L, 14L, 15L, 16L, 17L, 21L, 
                        22L, 23L, 24L, 25L, 26L, 27L, 28L, 29L, 31L, 32L, 33L, 35L, 41L, 
                        42L, 43L, 50L, 51L, 52L, 53L), 
                 V2 = structure(c(22L, 1L, 4L, 
                                  23L, 14L, 3L, 27L, 10L, 18L, 6L, 20L, 15L, 17L, 2L, 26L, 5L, 
                                  13L, 8L, 19L, 25L, 16L, 24L, 21L, 12L, 11L, 9L, 7L), 
                                .Label = c("Acre", "Alagoas", "Amapá", "Amazonas", "Bahia", "Ceará", "Distrito Federal", 
                                           "Espírito Santo", "Goiás", "Maranhão", "Mato Grosso", "Mato Grosso do Sul", 
                                           "Minas Gerais", "Pará", "Paraíba", "Paraná", "Pernambuco", "Piauí", 
                                           "Rio de Janeiro", "Rio Grande do Norte", "Rio Grande do Sul", 
                                           "Rondônia", "Roraima", "Santa Catarina", "São Paulo", "Sergipe", 
                                           "Tocantins"), class = "factor")), .Names = c("uf", "uf_name"), 
            class = "data.frame", row.names = c(NA, -27L))
uf$cp_name <- c("Porto Velho" , "Rio Branco" , "Manaus", "Boa Vista", "Belém", "Macapá", "Palmas", "São Luís", "Teresina", 
                "Fortaleza" , "Natal", "João Pessoa" , "Recife" , "Maceió" , "Aracaju", "Salvador", "Belo Horizonte" , 
                "Vitória" , "Rio de Janeiro", "São Paulo" , "Curitiba", "Florianópolis" , "Porto Alegre", "Campo Grande", 
                "Cuiabá", "Goiânia" , "Brasília" )

# monta tabela com deflatores
# lê arquivo do excel
deflat_tab <- read_xls( here( "resources/deflator_2017_pnadc.xls" ) , sheet = 1 )

# converte para data.table
deflat_tab <- as.data.table( deflat_tab )

# ajusta nomes
colnames( deflat_tab ) <- tolower( colnames( deflat_tab ) )
setnames( deflat_tab , "trim" , "trimestre" )

# lista arquivos
data_dir <- path.expand( "~/Bases/PNAD Contínua/Anual" )
these_files <- list.files( data_dir , full.names = TRUE , recursive = TRUE )

# filtra para 1ª entrevista
these_files <- these_files[ grepl( "1 pnadc" , basename( these_files ) ) ]

# filtra anos
these_files <- these_files[ grepl( "201(6|7)" , basename( these_files ) ) ]

# cria objetos de desenho amostral
pnadc_df <- lapply( these_files, function( this_file ) {
  
  # define colunas
  these_columns <- c("ano", "trimestre", "uf", "capital", "upa", "estrato", "v1008" , "v1030", "v1031", "posest", 
                     "v1022", "v2007" , "v2009" , "vd2002" , "vd2003" , "vd4016" , "vd4019" , "vd4048" )
  
  # ajusta colunas
  these_columns <- intersect( fst.metadata( this_file )[[4]] , these_columns )
  
  # lê base de dados
  pnadc_df <- read_fst( this_file , columns = these_columns , as.data.table = TRUE )
  
  # # total de moradores
  # pnadc_df[ !(vd2002 %in% 17:19) , nmor := .N , by = .( upa , v1008 ) ]
  
  # cria agregados de renda domiciliar
  pnadc_df[ !(vd2002 %in% 17:19) , rtrab := sum( vd4019 , na.rm = TRUE ) , by = .( upa , v1008 ) ] # habitual de todos os trabalhos
  pnadc_df[ !(vd2002 %in% 17:19) , routr := sum( vd4048 , na.rm = TRUE ) , by = .( upa , v1008 ) ] # efetivo de outras fontes
  pnadc_df[ !(vd2002 %in% 17:19) , rdom := rtrab + routr ] # rendimento domiciliar
  pnadc_df[ !(vd2002 %in% 17:19) , rdpc := rdom / vd2003 ] # rendimento domiciliar per capita
  
  # combina deflator
  pnadc_df <- merge( pnadc_df , deflat_tab , by = c( "ano" , "trimestre" , "uf" ) , all.x = TRUE , all.y = FALSE )
  
  # deflaciona os rendas: habitual
  these_inc_cols <- c( intersect( c( "vd4016" , "vd4019" ) , these_columns ) , "rtrab" ) 
  pnadc_df[ , paste0( "def_" , these_inc_cols ) := lapply( .SD , function(x) x * co2 ) , .SDcols = these_inc_cols ]
  
  # deflaciona os rendas: efetivo
  these_inc_cols <- c( intersect( c( "vd5007" , "vd5008" , "vd4048" ) , these_columns ) , "routr" )
  pnadc_df[ , paste0( "def_" , these_inc_cols ) := lapply( .SD , function(x) x * co2e ) , .SDcols = these_inc_cols ]
  
  # cria agregados de renda domiciliar deflacionado
  pnadc_df[ !(vd2002 %in% 15:17) , def_rdom := def_rtrab + def_routr ] # rendimento domiciliar deflacionado
  pnadc_df[ !(vd2002 %in% 15:17) , def_rdpc := def_rdom / vd2003 ] # rendimento domiciliar per capita deflacionado
  
  # adiciona nomes de uf
  pnadc_df <- merge( pnadc_df , uf , by = "uf" )
  
  # coluna unitária
  pnadc_df[, one := 1]
  
  # cria regiao
  pnadc_df[, regiao := factor( substr( uf , 1 , 1 ) , labels = c( "Norte" , "Nordeste" , "Sudeste" , "Sul" , "Centro-Oeste" ) ) ]
  
  # cria situação do domicílio
  pnadc_df[, v1022 := factor( v1022 , labels = c( "Urbano" , "Rural" ) ) ]
  
  # cria sexo
  pnadc_df[, v2007 := factor( v2007 , labels = c( "Homem" , "Mulher" ) ) ]
  
  # retorna objeto
  pnadc_df
  
} )

# empilha bases de dados
pnadc_df <- rbindlist( pnadc_df , use.names = TRUE )

# calcula totais de pós-estratificação
df_pos <- pnadc_df[ !duplicated( pnadc_df[ , .( ano , posest ) ] ) ,  .( ano , posest , Freq = v1030 ) ]
df_pos <- data.frame( df_pos , stringsAsFactors = FALSE )

# transforma em data.frame
pnadc_df <- data.frame( pnadc_df , stringsAsFactors = FALSE )

# desenho amostral sem pós-estratificação
pnadc_design <-
  svydesign(
    ids = ~ upa , 
    strata = ~ interaction( ano , estrato ) , 
    weights = ~ v1031 , 
    data = pnadc_df ,
    nest = TRUE
  )


# objeto de desenho amostral final
pnadc_design <- postStratify( pnadc_design , ~ ano + posest , df_pos )

# remove objetos desnecessários
rm( pnadc_df , df_pos , uf , deflat_tab ) ; gc()

# aplica convey
pnadc_design <- convey_prep( pnadc_design )

# define fórmulas
formulae <- list( ~ano+one , ~ano+regiao )

# estima índice de gini
res1 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svygini , na.rm = TRUE , vartype = "ci" ) )

# estima razão de palma
res2 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyqsr , alpha2 = .9 , alpha1 = .4 , na.rm = TRUE , vartype = "ci" ) )

# crianças e adolescentes
pnadc_design <- subset( pnadc_design , v2009 <= 17 )

# estima fgt0
res3 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyfgt , g = 0 , abs_thresh = 235 , na.rm = TRUE , vartype = "ci" ) )

# estima fgt1
res4 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyfgt , g = 1 , abs_thresh = 235 , na.rm = TRUE , vartype = "ci" ) )

# estima fgt2
res5 <- lapply( formulae , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyfgt , g = 2 , abs_thresh = 235 , na.rm = TRUE , vartype = "ci" ) )

# desenho especial abrinq
pnadc_design <- subset( pnadc_design , v2009 <= 14 & ano == 2017 )

# estima fgt0
res6 <- lapply( c(formulae , ~ano+uf+uf_name) , function( this_formula ) svyby( ~def_rdpc , this_formula , pnadc_design , svyfgt , g = 0 , abs_thresh = 468.5 , na.rm = TRUE , vartype = "ci" ) )

# clean workspace
rm( pnadc_design , formulae , these_files , data_dir ) ; gc()

# salva objetos
save.image( here( "resources/despob_2017.Rds" ) )
```
```{r load_results, eval=TRUE, message=FALSE, warning=FALSE, cache=FALSE, include=FALSE}
# carrega estatísticas

# carrega libraries
library(here)
library(data.table)
library(survey)
library(convey)
library(ggplot2)
library(scales)

# carrega dados
load( here( "resources/despob_2017.Rds" ) )
```

### Desigualdade

Medindo pelo índice de Gini, a desigualdade no país se manteve estável. Entretanto, as estimativas pontuais parecem ter aumentado em 4 das 5 regiões, mas essas variações não são *estatisticamente significativas*, i.e., podem ser apenas erros amostrais.

```{r gini_plot, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, cache=FALSE}
# empilha gini
res1 <- lapply( res1 , data.table )
res1 <- rbindlist( res1 , use.names = TRUE , fill = TRUE )
res1[ is.na( regiao ) , area := "Brasil" ]
res1[ !is.na( regiao ) , area := regiao ]

gini_scale <- function(x) gsub( ".*\\." , "." , sprintf('%.3f', x ) )

ggplot( res1 , aes( area , def_rdpc , group = ano , fill = factor( ano ) ) ) + 
  geom_bar( stat = "identity", position = "dodge" , alpha = .5 ) +
  # geom_line( alpha = .3 ) + 
  geom_errorbar( aes(ymin=ci_l, ymax=ci_u ), width=.25 , position = position_dodge(.9) , color = "#FF9900" ) +
  # geom_errorbar(aes( ymin=ci_l, ymax=ci_u , color = year ), width=.25 , position = position_dodge(.8) , alpha = .9 ) +
  scale_y_continuous( breaks = seq(0,1,.2) , labels = gini_scale( seq(0,1,.2) ) , expand = c(0,0) , limits = c(NA , .75) ) +
  scale_fill_manual( values = c( "#222f44" , "#599ef3" ) ) +
  # scale_alpha_manual( values = c( .6 , 1 ) ) +
  labs( x = NULL , y = "Índice de Gini", 
        title = "Índice de Gini da Renda Domiciliar Per Capita" , 
        subtitle ="Brasil e Grandes Regiões, 2016-2017.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016-2017, 1ª entrevista. Microdados.") +
  guides( color = FALSE , fill = guide_legend(title = "Ano") , alpha = FALSE ) +
  # theme_dark() +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_blank() ,
         # panel.grid.minor.x = element_blank() , 
         # panel.grid.minor.x = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "grey" , size = .75 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1 , vjust = .5 ) ,
         plot.title = element_text(lineheight=.8, face="bold") )
```

Como sabemos, o índice de Gini não é a única medida de desigualdade. Ele também tende a ser mais sensível às desigualdades no centro da distribuição. Vamos, então, complementar nossa análise com o índice de Palma. As conclusões são similares, ainda que a estimativa pontual deste índice para o Brasil mostre um pequeno aumento de 2016 para 2017. Além disso, variação no nordeste se torna mais significativa, embora não o suficiente para afirmarmos que é estatisticamente significativa. 

```{r palma_plot, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, cache=FALSE}
# empilha palma
res2 <- lapply( res2 , data.table )
res2 <- rbindlist( res2 , use.names = TRUE , fill = TRUE )
res2[ is.na( regiao ) , area := "Brasil" ]
res2[ !is.na( regiao ) , area := regiao ]

ggplot( res2 , aes( area , def_rdpc , group = ano , fill = factor( ano ) ) ) + 
  geom_bar( stat = "identity", position = "dodge" , alpha = .5 ) +
  geom_errorbar( aes(ymin=ci_l, ymax=ci_u ), width=.25 , position = position_dodge(.9) , color = "#FF9900" ) +
  scale_fill_manual( values = c( "#222f44" , "#599ef3" ) ) +
  scale_y_continuous( expand = c(0,0) , limits = c(0 , 6.5) , breaks = seq( 0 , 10 , 1 ) ) +
  scale_alpha_manual( values = c( .6 , 1 ) ) +
  # coord_equal( ylim=c(.3 , .7) ) +
  labs( x = NULL , y = "Índice de Palma", 
        title = "Índice de Palma da Renda Domiciliar Per Capita" , 
        subtitle ="Brasil e Grandes Regiões, 2016-2017.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016-2017, 1ª entrevista. Microdados.") +
  # scale_color_brewer(type = "qual" , palette = "Dark2" , direction = 1 ) +
  guides( color = FALSE , fill = guide_legend(title = "Ano") , alpha = FALSE ) +
  # theme_dark() +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_blank() ,
         # panel.grid.minor.x = element_blank() , 
         # panel.grid.minor.x = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "grey" , size = .75 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1 , vjust = .5 ) ,
         plot.title = element_text(lineheight=.8, face="bold") )
```

### Pobreza na Infância

Antes de olhar as estatísticas, é importante esclarecer algumas questões metodológicas. Como já foi dito anteriormente, as rendas de 2016 e 2017 foram ajustadas para preços médios de 2017, permitindo que os valores sejam comparáveis entre si. Além disso, fixei a linha de pobreza em R$ 235.00, o equivalente a 1/4 do salário mínimo de 2017. De fato, esta linha costuma ser chamada de "linha de pobreza extrema", enquanto 1/2 s.m. seria a linha de pobreza propriamente dita. Vamos prosseguir com essa nomenclatura.

No sudeste, uma das regiões mais ricas do país, mesmo com desigualdade (geral) praticamente estável, há um indício de piora deste indicador. O norte, por outro lado, parece apresentar uma leve queda. Isto acaba por diferenciar norte e nordeste, apontando com mais claridade o segundo como a pior região em termos de extrema pobreza na infância.

```{r fgt0_plot, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, cache=FALSE}
# empilha fgt0
res3 <- lapply( res3 , data.table )
res3 <- rbindlist( res3 , use.names = TRUE , fill = TRUE )
res3[ is.na( regiao ) , area := "Brasil" ]
res3[ !is.na( regiao ) , area := regiao ]

ggplot( res3 , aes( area , def_rdpc , group = ano , fill = factor( ano ) ) ) + 
  geom_bar( stat = "identity", position = "dodge" , alpha = .5 ) +
  geom_errorbar( aes(ymin=ci_l, ymax=ci_u ), width=.25 , position = position_dodge(.9) , color = "#FF9900" ) +
  scale_y_continuous( labels = percent_format( accuracy = 1 ) , breaks = seq(0 , 1 , .05 ) , limits = c(0, .42) , expand = c(0,0) ) +
  labs( x = NULL , y = "Taxa de Pobreza Extrema", 
        title = "Taxa de pobreza extrema entre crianças e adolescentes" , 
        subtitle ="Brasil e Grandes Regiões, 2016-2017.\nLinha de Pobreza: R$ 235.00 a preços médios de 2017.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016-2017, 1ª entrevista. Microdados.") +
  guides( color = FALSE , fill = guide_legend(title = "Ano") , alpha = FALSE ) +
  scale_fill_manual( values = c( "#222f44" , "#599ef3" ) ) +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_blank() ,
         # panel.grid.minor.x = element_blank() , 
         # panel.grid.minor.x = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "grey" , size = .75 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1 , vjust = .5 ) ,
         plot.title = element_text(lineheight=.8, face="bold") )
```

A intensidade da pobreza extrema na infância se manteve estável, variando de 8.7% para 9.2%. Quanto às regiões, as variações, em geral, também não foram estatisticamente significativas. No entanto, o nordeste apresentou aumento significativo do hiato de pobreza.

```{r fgt1_plot, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE , cache=FALSE}
# empilha fgt1
res4 <- lapply( res4 , data.table )
res4 <- rbindlist( res4 , use.names = TRUE , fill = TRUE )
res4[ is.na( regiao ) , area := "Brasil" ]
res4[ !is.na( regiao ) , area := regiao ]

ggplot( res4 , aes( area , def_rdpc , group = ano , fill = factor( ano ) ) ) + 
  geom_bar( stat = "identity", position = "dodge" , alpha = .5 ) +
  geom_errorbar( aes(ymin=ci_l, ymax=ci_u ), width=.25 , position = position_dodge(.9) , color = "#FF9900" ) +
  scale_y_continuous( labels = percent_format( accuracy = 1 ) , breaks = seq(0 , 1 , .05 ) , limits = c(0, .225) , expand = c(0,0) ) +
  guides( color = FALSE , fill = guide_legend(title = "Ano") , alpha = FALSE ) +
  scale_fill_manual( values = c( "#222f44" , "#599ef3" ) ) +
  labs( x = NULL , y = "Hiato de Pobreza", 
        title = "Hiato de pobreza entre crianças e adolescentes" , 
        subtitle ="Brasil e Grandes Regiões, 2016-2017.\nLinha de Pobreza: R$ 235.00 a preços médios de 2017.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016-2017, 1ª entrevista. Microdados.") +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_blank() ,
         panel.grid.major.y = element_line( linetype = 3 , color = "grey" , size = .75 ) ,
         plot.title = element_text(lineheight=.8, face="bold") )
```

O hiato quadrático de pobreza indica que a desigualdade entre as crianças e adolescentes em extrema pobreza aumentou. No caso do Brasil, ainda que a taxa de pobreza extrema entre crianças e adolescentes se mostre estável, as variações de renda foram regressivas: quem estava ruim ficou ainda pior. Esta variação foi sentida em 4 das 5 regiões. Novamente, o nordeste merece destaque: de todas as regiões, esta apresentou a variação mais significativa, consolidando o pior lugar segundo este indicador.

```{r fgt2_plot, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE , cache=FALSE}
# empilha fgt2
res5 <- lapply( res5 , data.table )
res5 <- rbindlist( res5 , use.names = TRUE , fill = TRUE )
res5[ is.na( regiao ) , area := "Brasil" ]
res5[ !is.na( regiao ) , area := regiao ]

ggplot( res5 , aes( area , def_rdpc , group = ano , fill = factor( ano ) ) ) + 
  geom_bar( stat = "identity", position = "dodge" , alpha = .5 ) +
  geom_errorbar( aes(ymin=ci_l, ymax=ci_u ), width=.25 , position = position_dodge(.9) , color = "#FF9900" ) +
  scale_y_continuous( labels = percent_format( accuracy = 1 ) , breaks = seq(0 , 1 , .05 ) , limits = c(0, .125) , expand = c(0,0) ) +
  guides( color = FALSE , fill = guide_legend(title = "Ano") , alpha = FALSE ) +
  scale_fill_manual( values = c( "#222f44" , "#599ef3" ) ) +
  labs( x = NULL , y = "Hiato Quadrático de Pobreza", 
        title = "Hiato quadrático de pobreza entre crianças e adolescentes" , 
        subtitle ="Brasil e Grandes Regiões, 2016-2017.\nLinha de Pobreza: R$ 235.00 a preços médios de 2017.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2016-2017, 1ª entrevista. Microdados.") +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_blank() ,
         panel.grid.major.y = element_line( linetype = 3 , color = "grey" , size = .75 ) ,
         panel.grid.minor.y = element_line( linetype = 3 , color = "grey" , size = .325 ) ,
         plot.title = element_text(lineheight=.8, face="bold") )
```

### Concluindo

Em geral, a conclusão é simples: aquilo que não se manteve estável, definitivamente piorou. Isso revela um pouco do impacto da crise sobre as crianças e adolescentes no Brasil. Resta saber como a economia, no advento de sua recuperação, irá afetar esta população.

Para compor com o clima deprimente deste post, vamos ouvir Daíra cantando Belchior. Nesse mundo de *pessoas cinzas normais* e *humilhados do parque com os seus jornais*, vale lembrar que *amar e mudar as coisas* interessa mais.

<!--html_preserve-->
<br>
<div style="position:relative;height:0;padding-bottom:56.21%"><iframe src="https://www.youtube.com/embed/f3oO_-rqOo4?ecver=2" style="position:absolute;width:100%;height:100%;left:0" width="641" height="360" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>
<!--/html_preserve-->

### Um pós-escrito sobre o "Cenário da Infância e Adolescência no Brasil 2018"

Hoje também saiu o [Cenário da Infância e Adolescência no Brasil 2018](https://issuu.com/fundacaoabrinq/docs/cenario_da_infancia_2018_internet), da Fundação Abrinq. As principais manchetes falam que "40% das crianças e adolescentes até 14 anos vivem em situação de pobreza". Os dados foram estimados com a PNAD 2015. Embora as coisas não se comparem muito bem entre PNAD e PNADC, vamos tentar calcular estimativas mais recentes.

Nossas contas mostram que 47% das crianças e adolescentes^[Aqui estamos usando a definição da Abrinq, de até 14 anos.] estão vivendo em situação de pobreza no Brasil. E a constatação de que essa proporção sobe para 63% e 61% no nordeste e norte, respectivamente, é absolutamente aterradora.

```{r abrinq_plot_rg, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE , cache=TRUE}
# empilha fgt0
res6 <- lapply( res6 , data.table )
res6 <- rbindlist( res6 , use.names = TRUE , fill = TRUE )
res6[ !is.na( regiao ) , area := regiao ]
res6[ !is.na( uf ) , area := uf_name ]
res6[ is.na( area ) , area := "Brasil" ]

ggplot( res6[ !is.na( regiao ) | area == "Brasil" ] , aes( area , def_rdpc , group = ano ) ) + 
  geom_bar( stat = "identity", position = "dodge" , alpha = .5 , fill = "#222f44" ) +
  geom_errorbar( aes(ymin=ci_l, ymax=ci_u ), width=.25 , position = position_dodge(.9) , color = "#FF9900" ) +
  scale_y_continuous( labels = percent_format( accuracy = 1 ) , breaks = seq(0 , 1 , .2 ) , limits = c(0,.75) , expand = c(0,0) ) +
  scale_x_discrete( limits = res6[ !is.na( regiao ) | area == "Brasil" ]$area ) +
  labs( x = NULL , y = "Taxa de Pobreza", 
        title = "Taxa de pobreza entre crianças e adolescentes até 14 anos" , 
        subtitle ="Brasil e Grandes Regiões, 2017.\nLinha de Pobreza: R$ 468.50 a preços médios de 2017.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2017, 1ª entrevista. Microdados.") +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_blank() ,
         # panel.grid.minor.x = element_blank() , 
         # panel.grid.minor.x = element_line( linetype = 3 , color = "lightgrey" , size = .2 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "grey" , size = .75 ) ,
         panel.grid.minor.y = element_line( linetype = 3 , color = "grey" , size = .325 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1 , vjust = .5 ) ,
         plot.title = element_text(lineheight=.8, face="bold") )
```

Maranhão, Alagoas, e Amazonas são os 3 piores estados, com aproximadamente 7 em cada 10 crianças e adolescentes até 14 anos em situação de pobreza.

```{r fgt0_abrinq_uf, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, cache=FALSE}
# reordena tabela
res6 <- res6[ order( one , -def_rdpc , na.last = TRUE ) , ]

ggplot( res6[ !is.na( uf ) | area == "Brasil" ] , aes( area , def_rdpc , group = ano ) ) + 
  geom_bar( stat = "identity", position = "dodge" , alpha = .5 , fill = "#222f44" ) +
  geom_errorbar( aes(ymin=ci_l, ymax=ci_u ), width=.25 , position = position_dodge(.9) , color = "#FF9900" ) +
  scale_y_continuous( labels = percent_format( accuracy = 1 ) , breaks = seq(0 , 1 , .2 ) , limits = c(0,.85) , expand = c(0,0) ) +
  scale_x_discrete( limits = res6[ !is.na( uf ) | area == "Brasil" ]$area ) +
  labs( x = NULL , y = "Taxa de Pobreza", 
        title = "Taxa de pobreza entre crianças e adolescentes até 14 anos" , 
        subtitle ="Brasil e UFs, 2017.\nLinha de Pobreza: R$ 468.50 de Julho/2017.\nCom intervalo de confiança de 95%." ,
        caption = "Fonte: PNAD Contínua 2017, 1ª entrevista. Microdados.") +
  theme( panel.background = element_blank() ,
         panel.grid.major.x = element_blank() ,
         axis.text.x = element_text( angle = 90 , hjust = 1 , vjust = .5 ) ,
         panel.grid.major.y = element_line( linetype = 3 , color = "grey" , size = .75 ) ,
         panel.grid.minor.y = element_line( linetype = 3 , color = "grey" , size = .325 ) ,
         # axis.text.x = element_text(angle = 90, hjust = 1 , vjust = .5 ) ,
         plot.title = element_text(lineheight=.8, face="bold") )
```

A distribuição espacial mostra como as taxas de pobreza mais altas tendem a se concentrar nos estados do nordeste e norte do Brasil.

```{r fgt0_abrinq_uf_mapa, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, cache=TRUE }
# load libraries
library(ggplot2)
library(maptools)
library(rgeos)
library(rgdal)
library(ggthemes)

# list and select maps
mapfile <- "~/Bases/Mapas/2016/BR/BRUFE250GC_SIR.shp"

# read map
brmap <- readOGR( dsn = mapfile , verbose = FALSE , stringsAsFactors = FALSE , encoding = "utf8" )

# fix names
colnames( brmap@data ) <- tolower( colnames( brmap@data ) )

# apply standardized projection
brmap <- spTransform( brmap , CRS("+proj=longlat +datum=WGS84") )

# fortify data
final.data <- fortify ( brmap , region = "cd_geocuf" )

# merge two datasets and create final plot data
res6_uf <- res6[ !is.na( uf ) , .( uf , uf_name , def_rdpc ) ]
res6_uf[ , uf := as.character( uf ) ]
res6_uf <- merge( res6_uf , brmap@data , by.x = "uf" , by.y = "cd_geocuf" , all.x = TRUE , all.y = FALSE )
final.data <- merge( final.data , res6_uf , by.x = "id" , by.y = "uf" , all.x = TRUE , all.y = FALSE )

# plot map
ggplot ( final.data , aes( x = long, y = lat, group = group , fill = def_rdpc , color = def_rdpc ) ) +
  geom_polygon( size = .10 ) + 
  coord_map() +
  # scale_fill_continuous( low = "blue" , high = "red" , limits = c( 0 , 1 ) , labels = scales::percent ) +
  # scale_fill_gradient( low = rgb(105,137,93,maxColorValue = 255) , high = rgb(128,18,24,maxColorValue = 255) , limits = c( 0 , .7 ) , labels = scales::percent , guide = "legend" ) +
  scale_fill_gradient2( low = rgb(105,137,93,maxColorValue = 255) , mid = rgb(254,236,171,maxColorValue = 255) , high = rgb(128,18,24,maxColorValue = 255) , limits = c( 0 , .8 ) , labels = percent_format( accuracy = 1 ) , guide = "legend" , midpoint = .3 ) +
  scale_color_gradient2( low = rgb(105,137,93,maxColorValue = 255) , mid = rgb(254,236,171,maxColorValue = 255) , high = rgb(128,18,24,maxColorValue = 255) , limits = c( 0 , .8 ) , labels = percent_format( accuracy = 1 ) , guide = "legend" , midpoint = .3 ) +
  # scale_fill_gradient_tableau( labels = scales::percent , guide = "legend" ) +
  labs( title = "Mapa da pobreza entre crianças e adolescentes até 14 anos" , 
        subtitle ="UFs, 2017.\nLinha de Pobreza: R$ 468.50 de Julho/2017." ,
        caption = "Fonte: PNAD Contínua 2017, 1ª entrevista. Microdados.") +
  guides( fill = guide_legend( title = "Taxa de Pobreza" ) , color = FALSE ) +
  theme_dark() +
  theme( panel.background = element_rect( fill = "white" ) , 
         axis.text=element_blank(), 
         axis.ticks=element_blank() , 
         axis.title = element_blank() ,
         panel.grid = element_blank() ,
         plot.title = element_text(lineheight=.8, face="bold") )


```
